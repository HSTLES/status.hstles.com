#
# Custom HSTLES Status Page Deployment
# This workflow deploys the custom status dashboard instead of Upptime's default Sapper site
# The Upptime monitoring engine (uptime.yml, response-time.yml, etc.) continues to run unchanged
#

name: Static Site CI
on:
  schedule:
    - cron: "0 1 * * *"
  repository_dispatch:
    types: [static_site]
  workflow_dispatch:
  push:
    branches: [main, master]
    paths:
      - 'index.html'
      - 'config.json'
      - 'assets/**'

jobs:
  deploy:
    name: Deploy custom status page
    runs-on: ubuntu-latest
    if: "!contains(github.event.head_commit.message, '[skip ci]')"
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          ref: ${{ github.head_ref }}
          token: ${{ secrets.GH_PAT || github.token }}

      - name: Prepare deployment
        run: |
          mkdir -p deploy
          cp index.html deploy/
          cp config.json deploy/
          cp -r api deploy/ 2>/dev/null || echo "No api directory yet"
          cp -r graphs deploy/ 2>/dev/null || echo "No graphs directory yet"
          cp -r history deploy/ 2>/dev/null || echo "No history directory yet"
          cp -r assets deploy/ 2>/dev/null || echo "No assets directory yet"
          echo "Deployment prepared successfully"
          ls -la deploy/

      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v4
        with:
          github_token: ${{ secrets.GH_PAT || github.token }}
          publish_dir: ./deploy
          force_orphan: false
          user_name: "HSTLES Bot"
          user_email: "bot@hstles.com"
          cname: status.hstles.com
